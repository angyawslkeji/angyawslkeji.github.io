(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["zh_zbkq-pages-poster_coup-index"],{"0e97":function(t,e,a){var n=a("24fb");e=n(!1),e.push([t.i,"uni-page-body[data-v-78e3f78a]{background-color:#edeef2}.poste_box[data-v-78e3f78a]{width:85%;margin:auto;margin-top:%?50?%;background-color:#fff;border:%?1?% solid #ddd;-webkit-box-shadow:0 0 10px 5px #d8d7dd;box-shadow:0 0 10px 5px #d8d7dd}.savePoste[data-v-78e3f78a]{background-color:#ff8427;width:90%;margin-left:auto;margin-right:auto;margin-top:%?30?%;color:#fff}.saveTitle[data-v-78e3f78a]{font-size:%?25?%;color:#666;width:90%;margin-left:auto;margin-right:auto;margin-top:%?20?%;text-align:center}.tips[data-v-78e3f78a]{margin-top:%?50?%;text-align:center}.tips .saveBtn[data-v-78e3f78a]{background:#f66;border-radius:%?30?%;padding:%?12?% %?60?%;color:#fff;font-size:%?28?%}.tips .info[data-v-78e3f78a]{opacity:.8;font-size:x-small;margin-top:%?25?%}body.?%PAGE?%[data-v-78e3f78a]{background-color:#edeef2}",""]),t.exports=e},"17b8":function(t,e,a){"use strict";var n=a("5407"),o=a.n(n);o.a},"28f0":function(t,e,a){"use strict";a.r(e);var n=a("a9c8"),o=a.n(n);for(var i in n)"default"!==i&&function(t){a.d(e,t,(function(){return n[t]}))}(i);e["default"]=o.a},"3cc1":function(t,e,a){"use strict";a.r(e);var n=a("6cb8"),o=a("28f0");for(var i in o)"default"!==i&&function(t){a.d(e,t,(function(){return o[t]}))}(i);a("17b8");var s,c=a("f0c5"),r=Object(c["a"])(o["default"],n["b"],n["c"],!1,null,"78e3f78a",null,!1,n["a"],s);e["default"]=r.exports},5407:function(t,e,a){var n=a("0e97");"string"===typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);var o=a("4f06").default;o("ee7caa92",n,!0,{sourceMap:!1,shadowMode:!1})},"6cb8":function(t,e,a){"use strict";var n;a.d(e,"b",(function(){return o})),a.d(e,"c",(function(){return i})),a.d(e,"a",(function(){return n}));var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",[a("v-uni-view",{staticClass:"poste_box",attrs:{id:"canvas-container"}},[a("v-uni-canvas",{style:"width:100%;height:"+.85*t.sys.windowWidth+"px;",attrs:{"canvas-id":"myCanvas"}})],1),a("v-uni-view",{staticClass:"tips"},[a("v-uni-text",{staticClass:"saveBtn",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.saveShareImg.apply(void 0,arguments)}}},[t._v("保存图片 Sava Picture")]),a("v-uni-view",{staticClass:"info"},[t._v("保存到相册可在朋友圈分享海报")])],1)],1)},i=[]},a9c8:function(t,e,a){"use strict";var n;a("cb29"),a("fb6a"),a("ac1f"),a("5319"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o={data:function(){return{cardInfo:{bgImg:"https://we-pon-com-1251903635.cos.ap-hongkong.myqcloud.com/wxapp/img/800_x_800.jpg",qrCode:"https://ihogo-1251903635.file.myqcloud.com/qin/ä½å/qrCode/mininote.jpg",TagText:"",Name:"",Position:"程序员鼓励师乌拉",Mobile:"",price:"",vip:!1},sys:{}}},components:{},props:{},onLoad:function(){uni.showLoading({title:"生成中...",mask:!0,duration:5e4}),n=this;var t=this.getOpenerEventChannel();t.on("acceptDataFromOfflinePay",(function(t){n.cardInfo.coup_name=t.data.coup_name,n.cardInfo.address=t.data.address,n.cardInfo.end_time=t.data.end_time,n.cardInfo.md_name=t.data.md_name,t.data.vip&&(n.cardInfo.vip="../../../static/img/VIP1.png"),n.cardInfo.qrcode=t.data.qrcode,n.cardInfo.sysl=t.data.sysl.replace(/\s+/g,""),n.cardInfo.md_logo="https://we-pon-com-1251903635.coshk.myqcloud.com/"+t.data.md_logo})),uni.getSystemInfo({success:function(t){n.sys=t,n.getBgImgDown()}})},methods:{getBgImgDown:function(){var t=this;t.getQrCode("../../../static/img/800_x_800.jpg")},getQrCode:function(t){var e=this;uni.downloadFile({url:e.cardInfo.qrcode,success:function(a){if(200===a.statusCode){var n=a.tempFilePath;e.getMDlogo(t,n)}else uni.showToast({title:"二维码下载失败！",icon:"none",duration:2e3,success:function(){var a="";e.getMDlogo(t,a)}})}})},getMDlogo:function(t,e){var a=this;uni.downloadFile({url:a.cardInfo.md_logo,success:function(n){if(200===n.statusCode){var o=n.tempFilePath;a.sharePosteCanvas(t,e,o)}else uni.showToast({title:"二维码下载失败！",icon:"none",duration:2e3,success:function(){}})}})},sharePosteCanvas:function(t,e,a){var n=this,o=n.cardInfo,i=uni.createCanvasContext("myCanvas"),s="";uni.createSelectorQuery().select("#canvas-container").boundingClientRect((function(n){n.height,n.right;s=1*n.width;var c=.035*s;i.setFillStyle("#fff"),i.fillRect(0,0,n.width,n.width);var r=-5,l=500*s/900;if(t&&(i.drawImage(t,0,0,s,l),i.setFontSize(14),i.setFillStyle("#fff"),i.setTextAlign("left")),o.TagText){i.setFontSize(18),i.fillText(o.TagText,c+100,l-15);i.measureText(o.TagText);i.stroke(),i.fill()}if(o.md_name&&(o.md_name.length>19&&(o.md_name=o.md_name.substr(0,19)+"..."),i.setTextAlign("left"),i.setFillStyle("#000000"),i.setFontSize(17),i.fillText(o.md_name,c,.67*s)),o.coup_name&&(getApp().globalData.utilmy.strlen(o.coup_name)>8&&(o.coup_name=o.coup_name.substr(0,5)+"..."),i.setTextAlign("left"),i.setFillStyle("#f44"),i.setFontSize(28),i.fillText(o.coup_name,c-1,.81*s)),o.end_time&&(i.setFontSize(12),i.setFillStyle("#000"),i.setTextAlign("left"),i.fillText(o.end_time,c,.93*s)),o.address,o.sysl){i.setFontSize(12),i.setFillStyle("#aaa"),i.setTextAlign("left");for(var d=o.sysl,u="",f=[],g=0;g<d.length;g++)u=d[g],f.push(u);for(var m=f.length-1;m>-1;m--)isNaN(f[m]),i.fillText(f[m],.6*s,.82*s-11*(m-f.length/2))}a&&(i.drawImage(a,.67*s,.624*s,.31*s,.31*s),i.setFontSize(10),i.setFillStyle("#000"),i.fillText("微信扫码或长按识别",c+160,s+195+r)),o.vip&&i.drawImage(o.vip,12.2*c,.86*s,.11*s,.11*s),e&&(i.drawImage(e,.177*s,.247*s,.188*s,.188*s),i.setFontSize(10),i.setFillStyle("#000"))})).exec();var c=999;setTimeout((function(){i.draw()}),c),setTimeout((function(){uni.hideLoading()}),c+1399)},textByteLength:function(t,e){for(var a=0,n=1,o=0,i=[],s=0;s<t.length;s++)t.charCodeAt(s)>255?(a+=2,a>n*e&&(a++,i.push(t.slice(o,s)),o=s,n++)):(a++,a>n*e&&(i.push(t.slice(o,s)),o=s,n++));return i.push(t.slice(o,t.length)),[a,i,n]},saveShareImg:function(){setTimeout((function(){uni.canvasToTempFilePath({canvasId:"myCanvas",success:function(t){var e=t.tempFilePath;uni.saveImageToPhotosAlbum({filePath:e,success:function(t){uni.showModal({content:"图片已保存到相册，赶紧晒一下吧~Picture Save Success!",showCancel:!1,confirmText:"好的",confirmColor:"#333",success:function(t){t.confirm},fail:function(t){}})},fail:function(t){uni.showToast({title:t.errMsg,icon:"none",duration:2e3})}})}})}),1e3)}}};e.default=o},cb29:function(t,e,a){var n=a("23e7"),o=a("81d5"),i=a("44d2");n({target:"Array",proto:!0},{fill:o}),i("fill")}}]);