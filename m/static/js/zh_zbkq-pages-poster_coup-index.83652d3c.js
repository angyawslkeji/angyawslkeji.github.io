(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["zh_zbkq-pages-poster_coup-index"],{"0e97":function(e,t,n){var a=n("24fb");t=a(!1),t.push([e.i,"uni-page-body[data-v-78e3f78a]{background-color:#edeef2}.poste_box[data-v-78e3f78a]{width:85%;margin:auto;margin-top:%?50?%;background-color:#fff;border:%?1?% solid #ddd;-webkit-box-shadow:0 0 10px 5px #d8d7dd;box-shadow:0 0 10px 5px #d8d7dd}.savePoste[data-v-78e3f78a]{background-color:#ff8427;width:90%;margin-left:auto;margin-right:auto;margin-top:%?30?%;color:#fff}.saveTitle[data-v-78e3f78a]{font-size:%?25?%;color:#666;width:90%;margin-left:auto;margin-right:auto;margin-top:%?20?%;text-align:center}.tips[data-v-78e3f78a]{margin-top:%?50?%;text-align:center}.tips .saveBtn[data-v-78e3f78a]{background:#f66;border-radius:%?30?%;padding:%?12?% %?60?%;color:#fff;font-size:%?28?%}.tips .info[data-v-78e3f78a]{opacity:.8;font-size:x-small;margin-top:%?25?%}body.?%PAGE?%[data-v-78e3f78a]{background-color:#edeef2}",""]),e.exports=t},"17b8":function(e,t,n){"use strict";var a=n("5407"),o=n.n(a);o.a},"28f0":function(e,t,n){"use strict";n.r(t);var a=n("a9c8"),o=n.n(a);for(var i in a)"default"!==i&&function(e){n.d(t,e,(function(){return a[e]}))}(i);t["default"]=o.a},"3cc1":function(e,t,n){"use strict";n.r(t);var a=n("6cb8"),o=n("28f0");for(var i in o)"default"!==i&&function(e){n.d(t,e,(function(){return o[e]}))}(i);n("17b8");var s,c=n("f0c5"),r=Object(c["a"])(o["default"],a["b"],a["c"],!1,null,"78e3f78a",null,!1,a["a"],s);t["default"]=r.exports},5407:function(e,t,n){var a=n("0e97");"string"===typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);var o=n("4f06").default;o("ee7caa92",a,!0,{sourceMap:!1,shadowMode:!1})},"6cb8":function(e,t,n){"use strict";var a;n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){return a}));var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-uni-view",[n("v-uni-view",{staticClass:"poste_box",attrs:{id:"canvas-container"}},[n("v-uni-canvas",{style:"width:100%;height:"+.85*e.sys.windowWidth+"px;",attrs:{"canvas-id":"myCanvas"}})],1),n("v-uni-view",{staticClass:"tips"},[n("v-uni-text",{staticClass:"saveBtn",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.saveShareImg.apply(void 0,arguments)}}},[e._v("保存图片 Sava Picture")]),n("v-uni-view",{staticClass:"info"},[e._v("保存到相册可在朋友圈分享海报")])],1)],1)},i=[]},a9c8:function(e,t,n){"use strict";var a;n("cb29"),n("fb6a"),n("ac1f"),n("5319"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o={data:function(){return{cardInfo:{bgImg:"https://we-pon-com-1251903635.cos.ap-hongkong.myqcloud.com/wxapp/img/800_x_800_.png",qrCode:"https://ihogo-1251903635.file.myqcloud.com/qin/ä½å/qrCode/mininote.jpg",TagText:"",Name:"",Position:"程序员鼓励师乌拉",Mobile:"",price:""},sys:{}}},components:{},props:{},onLoad:function(){uni.showLoading({title:"生成中...",mask:!0,duration:5e4}),a=this;var e=this.getOpenerEventChannel();e.on("acceptDataFromOfflinePay",(function(e){a.cardInfo.coup_name=e.data.coup_name,a.cardInfo.address=e.data.address,a.cardInfo.end_time=e.data.end_time,a.cardInfo.md_name=e.data.md_name,a.cardInfo.qrcode=e.data.qrcode,a.cardInfo.sysl=e.data.sysl.replace(/\s+/g,""),a.cardInfo.md_logo="https://we-pon-com-1251903635.coshk.myqcloud.com/"+e.data.md_logo})),uni.getSystemInfo({success:function(e){a.sys=e,a.getBgImgDown()}})},methods:{getBgImgDown:function(){var e=this;uni.downloadFile({url:e.cardInfo.bgImg,success:function(t){if(200===t.statusCode){var n=t.tempFilePath;e.getQrCode(n)}else uni.showToast({title:"头像下载失败！",icon:"none",duration:2e3,success:function(){var t="";e.getQrCode(t)}})}})},getQrCode:function(e){var t=this;uni.downloadFile({url:t.cardInfo.qrcode,success:function(n){if(200===n.statusCode){var a=n.tempFilePath;t.getMDlogo(e,a)}else uni.showToast({title:"二维码下载失败！",icon:"none",duration:2e3,success:function(){var n="";t.getMDlogo(e,n)}})}})},getMDlogo:function(e,t){var n=this;uni.downloadFile({url:n.cardInfo.md_logo,success:function(a){if(200===a.statusCode){var o=a.tempFilePath;n.sharePosteCanvas(e,t,o)}else uni.showToast({title:"二维码下载失败！",icon:"none",duration:2e3,success:function(){}})}})},sharePosteCanvas:function(e,t,n){var a=this,o=a.cardInfo,i=uni.createCanvasContext("myCanvas"),s="";uni.createSelectorQuery().select("#canvas-container").boundingClientRect((function(a){a.height,a.right;s=1*a.width;var c=.398*s;i.setFillStyle("#fff"),i.fillRect(0,0,a.width,a.width);var r=-5,l=500*s/900;if(e&&(i.drawImage(e,0,0,.994*s,.994*s),i.setFontSize(14),i.setFillStyle("#fff"),i.setTextAlign("left")),o.TagText){i.setFontSize(18),i.fillText(o.TagText,c+100,l-15);i.measureText(o.TagText);i.stroke(),i.fill()}if(o.md_name&&(o.md_name.length>15&&(o.md_name=o.md_name.substr(0,15)+"..."),i.setTextAlign("left"),i.setFillStyle("#000000"),i.setFontSize(17),i.fillText(o.md_name,c,.68*s)),o.coup_name&&(o.coup_name.length>8&&(o.coup_name=o.coup_name.substr(0,8)+"..."),i.setTextAlign("left"),i.setFillStyle("#f44"),i.setFontSize(21),i.fillText(o.coup_name,c-1,.79*s)),o.end_time&&(i.setFontSize(12),i.setFillStyle("#000"),i.setTextAlign("left"),i.fillText(o.end_time,c,.89*s)),o.address,o.sysl){i.setFontSize(12),i.setFillStyle("#aaa"),i.setTextAlign("left");for(var u=o.sysl,d="",f=[],g=0;g<u.length;g++)d=u[g],f.push(d);for(var m=0;m<f.length;m++)isNaN(f[m]),i.fillText(f[m],.9*s,.79*s+11*(m-f.length/2))}n&&(i.drawImage(n,.034*s,.624*s,.31*s,.31*s),i.setFontSize(10),i.setFillStyle("#000"),i.fillText("微信扫码或长按识别",c+160,s+195+r)),t&&(i.drawImage(t,.17*s,.25*s,.195*s,.195*s),i.setFontSize(10),i.setFillStyle("#000"))})).exec(),setTimeout((function(){i.draw(),setTimeout((function(){uni.hideLoading()}),666)}),1222)},textByteLength:function(e,t){for(var n=0,a=1,o=0,i=[],s=0;s<e.length;s++)e.charCodeAt(s)>255?(n+=2,n>a*t&&(n++,i.push(e.slice(o,s)),o=s,a++)):(n++,n>a*t&&(i.push(e.slice(o,s)),o=s,a++));return i.push(e.slice(o,e.length)),[n,i,a]},saveShareImg:function(){setTimeout((function(){uni.canvasToTempFilePath({canvasId:"myCanvas",success:function(e){var t=e.tempFilePath;uni.saveImageToPhotosAlbum({filePath:t,success:function(e){uni.showModal({content:"图片已保存到相册，赶紧晒一下吧~Picture Save Success!",showCancel:!1,confirmText:"好的",confirmColor:"#333",success:function(e){e.confirm},fail:function(e){}})},fail:function(e){uni.showToast({title:e.errMsg,icon:"none",duration:2e3})}})}})}),1e3)}}};t.default=o},cb29:function(e,t,n){var a=n("23e7"),o=n("81d5"),i=n("44d2");a({target:"Array",proto:!0},{fill:o}),i("fill")}}]);