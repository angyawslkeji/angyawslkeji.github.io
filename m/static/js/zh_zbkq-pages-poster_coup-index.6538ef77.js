(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["zh_zbkq-pages-poster_coup-index"],{"28f0":function(e,t,n){"use strict";n.r(t);var a=n("a9c8"),i=n.n(a);for(var o in a)"default"!==o&&function(e){n.d(t,e,(function(){return a[e]}))}(o);t["default"]=i.a},"3cc1":function(e,t,n){"use strict";n.r(t);var a=n("9fac"),i=n("28f0");for(var o in i)"default"!==o&&function(e){n.d(t,e,(function(){return i[e]}))}(o);n("8774");var s,c=n("f0c5"),l=Object(c["a"])(i["default"],a["b"],a["c"],!1,null,"26555160",null,!1,a["a"],s);t["default"]=l.exports},8774:function(e,t,n){"use strict";var a=n("c87e"),i=n.n(a);i.a},"9fac":function(e,t,n){"use strict";var a;n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return a}));var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-uni-view",[n("v-uni-view",{staticClass:"poste_box",attrs:{id:e.canvasDivID}},[e.showloading?n("v-uni-image",{staticClass:"qrcodeimg",style:"width:"+.85*e.sys.windowWidth+"px;height:"+.85*e.sys.windowWidth*6/9+"px;",attrs:{src:"https://temp-customs-1251903635.cos.ap-chengdu.myqcloud.com/Spb2u.net%20NewZealand/spb2u%20wxapp/zaozao%20kuaigou/new_wxapp/Ball%2BCross%2BLoading%2BImage%2BGif.gif"}}):e._e(),e.showloading?e._e():n("v-uni-canvas",{style:"width:100%;height:"+.85*e.sys.windowWidth+"px;",attrs:{"canvas-id":e.canvasID}})],1),n("v-uni-view",{staticClass:"tips"},[n("v-uni-text",{staticClass:"saveBtn",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.saveShareImg.apply(void 0,arguments)}}},[e._v("保存图片 Sava Picture")]),n("v-uni-view",{staticClass:"info"},[e._v("保存到相册可在朋友圈分享海报")])],1),n("v-uni-view",{staticClass:"chooseDiv"},e._l(e.bgList,(function(t,a){return n("v-uni-image",{class:e.selectIndex==a+1?"imgselect":"",attrs:{src:t,mode:"widthFix"},on:{click:function(n){arguments[0]=n=e.$handleEvent(n),e.selectImg(t,a)}}})})),1)],1)},o=[]},a8a9:function(e,t,n){var a=n("24fb");t=a(!1),t.push([e.i,"uni-page-body[data-v-26555160]{background-color:#edeef2}.poste_box[data-v-26555160]{width:85%;margin:auto;margin-top:%?50?%;background-color:#fff;border:%?1?% solid #ddd;box-shadow:0 0 10px 5px #d8d7dd}.savePoste[data-v-26555160]{background-color:#ff8427;width:90%;margin-left:auto;margin-right:auto;margin-top:%?30?%;color:#fff}.saveTitle[data-v-26555160]{font-size:%?25?%;color:#666;width:90%;margin-left:auto;margin-right:auto;margin-top:%?20?%;text-align:center}.tips[data-v-26555160]{margin-top:%?50?%;text-align:center}.tips .saveBtn[data-v-26555160]{background:#f66;border-radius:%?30?%;padding:%?12?% %?60?%;color:#fff;font-size:%?28?%}.tips .info[data-v-26555160]{opacity:.8;font-size:x-small;margin-top:%?25?%}.chooseDiv[data-v-26555160]{display:flex;margin-top:%?15?%;flex-wrap:wrap;justify-content:space-evenly}.chooseDiv uni-image[data-v-26555160]{width:46%}.chooseDiv .imgselect[data-v-26555160]{width:44%;padding:%?10?%;border:%?6?% solid red}body.?%PAGE?%[data-v-26555160]{background-color:#edeef2}",""]),e.exports=t},a9c8:function(e,t,n){"use strict";var a;n("cb29"),n("c975"),n("fb6a"),n("ac1f"),n("5319"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i={},o={data:function(){return{showloading:!0,canvasID:"mycanvas",canvasDivID:"canDiv",selectIndex:0,sys:{},bgList:["/static/img/800.png","/static/img/8002.png"]}},components:{},props:{},onLoad:function(){a=this;var e=this.getOpenerEventChannel();e.on("acceptDataFromOfflinePay",(function(e){i.coup_name=e.data.coup_name,i.address=e.data.address,i.end_time=e.data.end_time,i.md_name=e.data.md_name,i.name=e.data.name,e.data.vip&&(i.vip="../../../static/img/VIP1.png"),i.qrcode=e.data.qrcode,i.sysl=e.data.sysl.replace(/\s+/g,""),i.md_logo="https://we-pon-com-1251903635.coshk.myqcloud.com/"+e.data.md_logo,i.name.indexOf("广告券 Ads")>-1&&(i["type"]="ad",i["typeColor"]="#2ec100"),i.name.indexOf("折价券 Disc")>-1&&(i["type"]="折",i["typeColor"]="#ef2929"),i.name.indexOf("就餐券 Meal")>-1&&(i["type"]="餐",i["typeColor"]="crimson"),i.name.indexOf("代金券 Cash")>-1&&(i["type"]="金",i["typeColor"]="#ffa52a")})),uni.getSystemInfo({success:function(e){a.sys=e,a.getBgImgDown()}})},methods:{getBgImgDown:function(){var e="../../../static/img/choose.png";1==a.selectIndex&&(e="../../../static/img/800.png"),2==a.selectIndex&&(e="../../../static/img/8002.png"),a.getQrCode(e)},getQrCode:function(e){uni.downloadFile({url:i.qrcode,success:function(t){if(200===t.statusCode){var n=t.tempFilePath;a.getMDlogo(e,n)}else uni.showToast({title:"二维码下载失败！",icon:"none",duration:2e3,success:function(){var t="";a.getMDlogo(e,t)}})},fail:function(e){uni.showModal({title:"提示",content:JSON.stringify(e)+"",success:function(e){e.confirm?console.log("用户点击确定"):e.cancel&&console.log("用户点击取消")}})}})},getMDlogo:function(e,t){var n=this;uni.downloadFile({url:i.md_logo,success:function(a){if(200===a.statusCode){var i=a.tempFilePath;n.sharePosteCanvas(e,t,i)}else uni.showToast({title:"二维码下载失败！",icon:"none",duration:2e3,success:function(){}})},fail:function(e){uni.showModal({title:"提示",content:JSON.stringify(e)+"",success:function(e){e.confirm?console.log("用户点击确定"):e.cancel&&console.log("用户点击取消")}})}})},sharePosteCanvas:function(e,t,n){var a=this,o=uni.createCanvasContext(a.canvasID),s="";uni.createSelectorQuery().select("#"+a.canvasDivID).boundingClientRect((function(c){s=1*c.width;var l=.375*s;o.setFillStyle("#fff"),o.fillRect(0,0,c.width,c.width);var d=-5,r=450*s/850;if(e&&(o.drawImage(e,0,0,s,r),o.setFontSize(14),o.setFillStyle("#fff"),o.setTextAlign("left")),i.TagText){o.setFontSize(18),o.fillText(i.TagText,l+100,r-15);o.measureText(i.TagText);o.stroke(),o.fill()}i.md_name&&(i.md_name.length>18&&(i.md_name=i.md_name.substr(0,17)+"..."),o.setTextAlign("left"),o.setFillStyle("#000000"),o.setFontSize(18),o.fillText(i.md_name,l,.65*s)),i.coup_name&&(i.coup_name.indexOf("%")>-1||i.coup_name.length>7&&(i.coup_name=i.coup_name.substr(0,7)+"..."),o.setTextAlign("left"),o.setFillStyle("#f44"),o.setFontSize(29),o.fillText(i.coup_name,l,.76*s)),i.end_time&&(o.setFontSize(12),o.setFillStyle("#000"),o.setTextAlign("left"),o.fillText(i.end_time,l,.84*s)),o.setTextAlign("left"),o.setFontSize(12),o.textBaseline="bottom",o.fillText("长按二维码 即可 ",l,.922*s),o.setTextAlign("left"),o.setFontSize(12),o.setFillStyle("red"),o.textBaseline="bottom",o.fillText("导航 收藏 核销",1.81*l,.922*s),o.setStrokeStyle("whitesmoke"),o.lineJoin="round",o.lineWidth=2,o.strokeRect(.029*s,.608*s,.305*s,.305*s),i.vip&&o.drawImage(i.vip,2.14*l,.77*s,.11*s,.11*s),1==a.selectIndex&&o.drawImage(t,.177*s,.234*s,.182*s,.182*s),2==a.selectIndex&&o.drawImage(t,.518*s,.321*s,.173*s,.173*s),o.drawImage(n,.03*s,.613*s,.3*s,.3*s),o.setFontSize(10),o.setFillStyle("#000"),o.fillText("微信扫码或长按识别",l+160,s+195+d),o.setFontSize(10),o.setFillStyle("#000");var u=666;setTimeout((function(){a.showloading=!1}),u),o.draw(),o.restore(),uni.hideLoading()})).exec()},textByteLength:function(e,t){for(var n=0,a=1,i=0,o=[],s=0;s<e.length;s++)e.charCodeAt(s)>255?(n+=2,n>a*t&&(n++,o.push(e.slice(i,s)),i=s,a++)):(n++,n>a*t&&(o.push(e.slice(i,s)),i=s,a++));return o.push(e.slice(i,e.length)),[n,o,a]},saveShareImg:function(){uni.showLoading({title:"拼命保存中..."});var e=this;uni.canvasToTempFilePath({canvasId:e.canvasID,success:function(e){var t=e.tempFilePath;uni.saveImageToPhotosAlbum({filePath:t,success:function(e){uni.hideLoading(),uni.showModal({content:"图片已保存到相册，赶紧晒一下吧~Picture Save Success!",showCancel:!1,confirmText:"好的",confirmColor:"#333",success:function(e){e.confirm},fail:function(e){}})},fail:function(e){uni.showToast({title:e.errMsg,icon:"none",duration:2e3})}})}})},selectImg:function(e,t){uni.showLoading({title:"生成中...",mask:!0}),a.selectIndex=t+1,a.getBgImgDown()}}};t.default=o},c87e:function(e,t,n){var a=n("a8a9");"string"===typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);var i=n("4f06").default;i("53db1eb0",a,!0,{sourceMap:!1,shadowMode:!1})},cb29:function(e,t,n){var a=n("23e7"),i=n("81d5"),o=n("44d2");a({target:"Array",proto:!0},{fill:i}),o("fill")}}]);