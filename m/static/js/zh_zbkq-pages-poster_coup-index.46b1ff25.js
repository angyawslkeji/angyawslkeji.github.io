(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["zh_zbkq-pages-poster_coup-index"],{"06c5":function(e,t,n){"use strict";n("a630"),n("fb6a"),n("d3b7"),n("25f0"),n("3ca3"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=i;var a=o(n("6b75"));function o(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(e){if("string"===typeof e)return(0,a.default)(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?(0,a.default)(e,t):void 0}}},"09f0":function(e,t,n){"use strict";function a(e,t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e)){var n=[],a=!0,o=!1,i=void 0;try{for(var r,s=e[Symbol.iterator]();!(a=(r=s.next()).done);a=!0)if(n.push(r.value),t&&n.length===t)break}catch(u){o=!0,i=u}finally{try{a||null==s["return"]||s["return"]()}finally{if(o)throw i}}return n}}n("a4d3"),n("e01a"),n("d28b"),n("d3b7"),n("3ca3"),n("ddb0"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=a},"0d21":function(e,t,n){"use strict";function a(e){if(Array.isArray(e))return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=a},"16f9":function(e,t,n){var a=n("172c");"string"===typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);var o=n("4f06").default;o("6d7f2be6",a,!0,{sourceMap:!1,shadowMode:!1})},"172c":function(e,t,n){var a=n("24fb");t=a(!1),t.push([e.i,"uni-page-body[data-v-78e3f78a]{background-color:#edeef2}.poste_box[data-v-78e3f78a]{width:85%;margin:auto;margin-top:%?50?%;background-color:#fff;border:%?1?% solid #ddd;box-shadow:0 0 10px 5px #d8d7dd}.savePoste[data-v-78e3f78a]{background-color:#ff8427;width:90%;margin-left:auto;margin-right:auto;margin-top:%?30?%;color:#fff}.saveTitle[data-v-78e3f78a]{font-size:%?25?%;color:#666;width:90%;margin-left:auto;margin-right:auto;margin-top:%?20?%;text-align:center}.tips[data-v-78e3f78a]{margin-top:%?50?%;text-align:center}.tips .saveBtn[data-v-78e3f78a]{background:#f66;border-radius:%?30?%;padding:%?12?% %?60?%;color:#fff;font-size:%?28?%}.tips .info[data-v-78e3f78a]{opacity:.8;font-size:x-small;margin-top:%?25?%}body.?%PAGE?%[data-v-78e3f78a]{background-color:#edeef2}",""]),e.exports=t},3835:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=u;var a=s(n("0d21")),o=s(n("09f0")),i=s(n("06c5")),r=s(n("3d8c"));function s(e){return e&&e.__esModule?e:{default:e}}function u(e,t){return(0,a.default)(e)||(0,o.default)(e,t)||(0,i.default)(e,t)||(0,r.default)()}},"3d8c":function(e,t,n){"use strict";function a(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}Object.defineProperty(t,"__esModule",{value:!0}),t.default=a},4966:function(e,t,n){"use strict";n.r(t);var a=n("a242"),o=n.n(a);for(var i in a)"default"!==i&&function(e){n.d(t,e,(function(){return a[e]}))}(i);t["default"]=o.a},"49c0":function(e,t,n){"use strict";var a=n("16f9"),o=n.n(a);o.a},"4b41":function(e,t,n){"use strict";n.r(t);var a=n("ff4e"),o=n("4966");for(var i in o)"default"!==i&&function(e){n.d(t,e,(function(){return o[e]}))}(i);n("49c0");var r,s=n("f0c5"),u=Object(s["a"])(o["default"],a["b"],a["c"],!1,null,"78e3f78a",null,!1,a["a"],r);t["default"]=u.exports},"6b75":function(e,t,n){"use strict";function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}Object.defineProperty(t,"__esModule",{value:!0}),t.default=a},a242:function(e,t,n){"use strict";var a=n("4ea4");n("cb29"),n("fb6a"),n("ac1f"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,i=a(n("3835")),r={data:function(){return{cardInfo:{bgImg:"https://temp-customs-1251903635.cos.ap-chengdu.myqcloud.com/Spb2u.net%20NewZealand/spb2u%20wxapp/zaozao%20kuaigou/new_wxapp/shangjia_beijing.png",qrCode:"https://ihogo-1251903635.file.myqcloud.com/qin/ä½å/qrCode/mininote.jpg",TagText:"",Name:"",Position:"程序员鼓励师乌拉",Mobile:"",price:""},sys:{}}},components:{},props:{},onLoad:function(){o=this;var e=this.getOpenerEventChannel();e.on("acceptDataFromOfflinePay",(function(e){console.log(e),o.cardInfo.coup_name=e.data.coup_name,o.cardInfo.address=e.data.address,o.cardInfo.end_time=e.data.end_time,o.cardInfo.md_name=e.data.md_name,o.cardInfo.qrcode=e.data.qrcode,o.cardInfo.sysl=e.data.sysl,o.cardInfo.md_logo="https://we-pon-com-1251903635.coshk.myqcloud.com/"+e.data.md_logo,uni.setNavigationBarTitle({title:e.data.coup_name+"海报分享 "+e.data.md_name})})),uni.getSystemInfo({success:function(e){o.sys=e,o.getBgImgDown()}})},methods:{getBgImgDown:function(){uni.showLoading({title:"生成中...",mask:!0});var e=this;uni.downloadFile({url:e.cardInfo.bgImg,success:function(t){if(uni.hideLoading(),200===t.statusCode){var n=t.tempFilePath;e.getQrCode(n)}else uni.showToast({title:"头像下载失败！",icon:"none",duration:2e3,success:function(){var t="";e.getQrCode(t)}})}})},getQrCode:function(e){uni.showLoading({title:"生成中...",mask:!0});var t=this;uni.downloadFile({url:t.cardInfo.qrcode,success:function(n){if(uni.hideLoading(),200===n.statusCode){var a=n.tempFilePath;t.getMDlogo(e,a)}else uni.showToast({title:"二维码下载失败！",icon:"none",duration:2e3,success:function(){var n="";t.getMDlogo(e,n)}})}})},getMDlogo:function(e,t){uni.showLoading({title:"生成中...",mask:!0});var n=this;uni.downloadFile({url:n.cardInfo.md_logo,success:function(a){if(uni.hideLoading(),200===a.statusCode){var o=a.tempFilePath;n.sharePosteCanvas(e,t,o)}else uni.showToast({title:"二维码下载失败！",icon:"none",duration:2e3,success:function(){}})}})},sharePosteCanvas:function(e,t,n){uni.showLoading({title:"生成中...",mask:!0});var a=this,o=a.cardInfo,r=uni.createCanvasContext("myCanvas"),s="";uni.createSelectorQuery().select("#canvas-container").boundingClientRect((function(u){var l=23,c=u.height;u.right;s=1*u.width;var d=15;r.setFillStyle("#fff"),r.fillRect(0,0,u.width,c);var f=-5,g=500*s/900;if(e&&(r.drawImage(e,d-15,0,s,g),r.setFontSize(14),r.setFillStyle("#fff"),r.setTextAlign("left")),o.TagText){r.setFontSize(18),r.fillText(o.TagText,d+100,g-15);r.measureText(o.TagText);r.stroke(),r.fill()}if(o.md_name){var v=a.textByteLength(o.md_name,l),m=(0,i.default)(v,3),h=(m[0],m[1]);m[2];r.setTextAlign("left"),r.setFillStyle("#000000"),r.setFontSize(17);for(var p=22,y=0;y<h.length;y++)r.fillText(h[y],d,g+35+f+p*y)}if(o.coup_name){var b=a.textByteLength(o.coup_name,l),w=(0,i.default)(b,3),_=(w[0],w[1]);w[2];r.setTextAlign("left"),r.setFillStyle("#f44"),r.setFontSize(20);for(var x=22,T=0;T<_.length;T++)r.fillText(_[T],d,g+70+f+x*T)}o.end_time&&(r.setFontSize(14),r.setFillStyle("#000"),r.setTextAlign("left"),r.fillText(o.end_time,d,g+105+f)),o.address&&(o.address.length>33&&(o.address=o.address.substr(0,31)+"..."),r.setTextAlign("left"),r.setFontSize(12),r.setFillStyle("#666"),r.fillText(o.address,d,g+132+f)),n&&(r.drawImage(n,.71*s,.6*s,.26*s,.26*s),r.setFontSize(10),r.setFillStyle("#000"),r.fillText("微信扫码或长按识别",d+160,s+195+f)),t&&(r.drawImage(t,.63*s,.19*s,.195*s,.195*s),r.setFontSize(10),r.setFillStyle("#000")),o.sysl&&(r.setFontSize(15),r.setFillStyle("#aaa"),r.setTextAlign("left"),r.fillText(o.sysl,.71*s,.96*s))})).exec(),setTimeout((function(){r.draw(),uni.hideLoading()}),1e3)},textByteLength:function(e,t){for(var n=0,a=1,o=0,i=[],r=0;r<e.length;r++)e.charCodeAt(r)>255?(n+=2,n>a*t&&(n++,i.push(e.slice(o,r)),o=r,a++)):(n++,n>a*t&&(i.push(e.slice(o,r)),o=r,a++));return i.push(e.slice(o,e.length)),[n,i,a]},saveShareImg:function(){uni.showLoading({title:"正在保存",mask:!0}),setTimeout((function(){uni.canvasToTempFilePath({canvasId:"myCanvas",success:function(e){uni.hideLoading();var t=e.tempFilePath;uni.saveImageToPhotosAlbum({filePath:t,success:function(e){uni.showModal({content:"图片已保存到相册，赶紧晒一下吧~Picture Save Success!",showCancel:!1,confirmText:"好的",confirmColor:"#333",success:function(e){e.confirm},fail:function(e){}})},fail:function(e){uni.showToast({title:e.errMsg,icon:"none",duration:2e3})}})}})}),1e3)}}};t.default=r},cb29:function(e,t,n){var a=n("23e7"),o=n("81d5"),i=n("44d2");a({target:"Array",proto:!0},{fill:o}),i("fill")},ff4e:function(e,t,n){"use strict";var a;n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){return a}));var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-uni-view",[n("v-uni-view",{staticClass:"poste_box",attrs:{id:"canvas-container"}},[n("v-uni-canvas",{style:"width:100%;height:"+.85*e.sys.windowWidth+"px;",attrs:{"canvas-id":"myCanvas"}})],1),n("v-uni-view",{staticClass:"tips"},[n("v-uni-text",{staticClass:"saveBtn",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.saveShareImg.apply(void 0,arguments)}}},[e._v("保存图片 Sava Picture")]),n("v-uni-view",{staticClass:"info"},[e._v("保存到相册可在朋友圈分享海报")])],1)],1)},i=[]}}]);